<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1"
	xmlns:fx="http://javafx.com/fxml/1"
	fx:controller="controllers.ManagerController" prefHeight="800.0"
	prefWidth="1200.0" stylesheets="@../css/ManagerMain.css">

	<!-- Top Bar  -->
	<top>
		<VBox spacing="10" style="-fx-background-color: #2C3E50;">
			<padding>
				<Insets bottom="10.0" left="20.0" right="20.0" top="10.0" />
			</padding>

			<HBox alignment="CENTER_LEFT" spacing="20">
				<Label text="BPark - Manager Dashboard" textFill="WHITE">
					<font>
						<Font name="System Bold" size="24.0" />
					</font>
				</Label>

				<Region HBox.hgrow="ALWAYS" />

				<Label fx:id="lblSystemStatus"
					text="System Status: Operational" textFill="#2ECC71">
					<font>
						<Font size="14.0" />
					</font>
				</Label>

				<Button text="Generate Reports"
					onAction="#handleGenerateReports" styleClass="report-button" />
				<Button fx:id="btnLogout" text="Logout"
					onAction="#handleLogout" styleClass="logout-button" />
			</HBox>
		</VBox>
	</top>

	<!-- Main Content -->
	<center>
		<TabPane tabClosingPolicy="UNAVAILABLE">

			<!-- Tab 1: Dashboard -->
			<Tab text="Dashboard">
				<ScrollPane fitToWidth="true" fitToHeight="true">
					<VBox spacing="20" style="-fx-background-color: #ECF0F1;">
						<padding>
							<Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
						</padding>

						<!-- Key Metrics -->
						<HBox spacing="20">
							<VBox spacing="5"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);"
								alignment="CENTER" prefWidth="200" prefHeight="100">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>
								<Label text="Total Spots" style="-fx-text-fill: #7F8C8D;" />
								<Label fx:id="lblTotalSpots" text="100"
									style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #2C3E50;" />
							</VBox>

							<VBox spacing="5"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);"
								alignment="CENTER" prefWidth="200" prefHeight="100">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>
								<Label text="Occupied" style="-fx-text-fill: #7F8C8D;" />
								<Label fx:id="lblOccupied" text="--"
									style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #E74C3C;" />
							</VBox>

							<VBox spacing="5"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);"
								alignment="CENTER" prefWidth="200" prefHeight="100">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>
								<Label text="Available" style="-fx-text-fill: #7F8C8D;" />
								<Label fx:id="lblAvailable" text="--"
									style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #27AE60;" />
							</VBox>

							<VBox spacing="5"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);"
								alignment="CENTER" prefWidth="200" prefHeight="100">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>
								<Label text="Active Reservations"
									style="-fx-text-fill: #7F8C8D;" />
								<Label fx:id="lblReservations" text="--"
									style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #3498DB;" />
							</VBox>
							
							<!-- Refresh Button with enhanced styling -->
							<VBox alignment="CENTER" spacing="5">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
								</padding>
								<Button fx:id="btnRefresh" text="Refresh" onAction="#refreshParkingStatus" 
									styleClass="refresh-button"
									prefHeight="40">
									<tooltip>
										<Tooltip text="Refresh parking status data" />
									</tooltip>
								</Button>
								<Label text="Update Now" style="-fx-text-fill: #7F8C8D; -fx-font-size: 11px;" />
							</VBox>
						</HBox>

						<!-- Charts Section -->
						<HBox spacing="20">
							<!-- Occupancy Chart -->
							<VBox spacing="10"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15;"
								HBox.hgrow="ALWAYS">
								<Label text="Hourly Occupancy"
									style="-fx-font-size: 16px; -fx-font-weight: bold;" />
								<LineChart fx:id="occupancyChart" prefHeight="300"
									animated="false">
									<xAxis>
										<CategoryAxis label="Hour" />
									</xAxis>
									<yAxis>
										<NumberAxis label="Occupied Spots" />
									</yAxis>
								</LineChart>
							</VBox>

							<!-- Parking Types Pie Chart -->
							<VBox spacing="10"
								style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15;"
								prefWidth="350">
								<Label text="Parking Types Distribution"
									style="-fx-font-size: 16px; -fx-font-weight: bold;" />
								<PieChart fx:id="parkingTypesChart" prefHeight="300"
									animated="true" />
							</VBox>
						</HBox>

						<!-- System Information -->
						<TitledPane text="System Configuration" expanded="false">
							<GridPane hgap="15" vgap="10">
								<padding>
									<Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
								</padding>

								<Label text="Total Parking Spots:"
									GridPane.columnIndex="0" GridPane.rowIndex="0" />
								<Label text="100" GridPane.columnIndex="1"
									GridPane.rowIndex="0" />

								<Label text="Auto-Cancellation Time:"
									GridPane.columnIndex="0" GridPane.rowIndex="1" />
								<Label text="15 minutes after scheduled time"
									GridPane.columnIndex="1" GridPane.rowIndex="1" />

								<Label text="Late Exit Grace Period:"
									GridPane.columnIndex="0" GridPane.rowIndex="2" />
								<Label text="10 minutes" GridPane.columnIndex="1"
									GridPane.rowIndex="2" />
							</GridPane>

							<Label
								text="Automatically cancels reservations 15 minutes after scheduled time if customer doesn't arrive"
								wrapText="true" style="-fx-text-fill: #7F8C8D;" />
						</TitledPane>

						<!-- Monthly Report Generation -->
						<TitledPane text="Monthly Reports" expanded="false">
							<VBox spacing="10">
								<padding>
									<Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
								</padding>

								<HBox spacing="10" alignment="CENTER_LEFT">
									<Label text="Select Month:" minWidth="100" />
									<ComboBox fx:id="comboMonth" prefWidth="150" />
									<ComboBox fx:id="comboYear" prefWidth="100" />
									<Button text="Generate Monthly Reports"
										onAction="#handleGenerateMonthlyReports" styleClass="primary-button" />
								</HBox>

								<Label
									text="Reports are automatically generated at the end of each month"
									style="-fx-text-fill: #7F8C8D;" />
							</VBox>
						</TitledPane>

						<!-- System Statistics -->
						<TitledPane text="System Statistics" expanded="false">
							<GridPane hgap="15" vgap="10">
								<padding>
									<Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
								</padding>

								<Label text="Total Registered Users:"
									GridPane.columnIndex="0" GridPane.rowIndex="0" />
								<Label fx:id="lblTotalUsers" text="--"
									GridPane.columnIndex="1" GridPane.rowIndex="0" />

								<Label text="Peak Usage Hours:" GridPane.columnIndex="0"
									GridPane.rowIndex="1" />
								<Label fx:id="lblPeakHours" text="--"
									GridPane.columnIndex="1" GridPane.rowIndex="1" />

								<Label text="Average Daily Usage:" GridPane.columnIndex="0"
									GridPane.rowIndex="2" />
								<Label fx:id="lblAvgDailyUsage" text="--"
									GridPane.columnIndex="1" GridPane.rowIndex="2" />
							</GridPane>
						</TitledPane>

					</VBox>
				</ScrollPane>
			</Tab>

			<!-- Tab 2: Reports -->
			<Tab text="Reports">
				<VBox spacing="15">
					<padding>
						<Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
					</padding>

					<!-- Report Controls -->
					<HBox spacing="15" alignment="CENTER_LEFT">
						<Label text="Report Type:" />
						<ComboBox fx:id="comboReportType" prefWidth="200" />
						<Label text="From:" />
						<DatePicker fx:id="datePickerFrom" prefWidth="150" />
						<Label text="To:" />
						<DatePicker fx:id="datePickerTo" prefWidth="150" />
						<Button text="Generate Report"
							onAction="#handleGenerateSelectedReport" styleClass="primary-button" />
					</HBox>

					<Separator />

					<!-- Report Tabs -->
					<TabPane VBox.vgrow="ALWAYS">
						<!-- Parking Time Report -->
						<Tab text="Parking Time Report">
							<VBox spacing="15">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>

								<GridPane hgap="20" vgap="10">
									<Label text="Average Parking Duration:"
										GridPane.columnIndex="0" GridPane.rowIndex="0" />
									<Label fx:id="lblAvgDuration" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="0" />

									<Label text="Total Parkings:" GridPane.columnIndex="0"
										GridPane.rowIndex="1" />
									<Label fx:id="lblTotalParkings" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="1" />

									<Label text="Late Exits:" GridPane.columnIndex="0"
										GridPane.rowIndex="2" />
									<Label fx:id="lblLateExits" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="2" />

									<Label text="Extensions:" GridPane.columnIndex="0"
										GridPane.rowIndex="3" />
									<Label fx:id="lblExtensions" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="3" />
								</GridPane>

								<BarChart fx:id="parkingTimeChart" VBox.vgrow="ALWAYS">
									<xAxis>
										<CategoryAxis label="Date" />
									</xAxis>
									<yAxis>
										<NumberAxis label="Average Duration (minutes)" />
									</yAxis>
								</BarChart>
							</VBox>
						</Tab>

						<!-- Subscriber Status Report -->
						<Tab text="Subscriber Status Report">
							<VBox spacing="15">
								<padding>
									<Insets bottom="15.0" left="15.0" right="15.0"
										top="15.0" />
								</padding>

								<GridPane hgap="20" vgap="10">
									<Label text="Active Subscribers:"
										GridPane.columnIndex="0" GridPane.rowIndex="0" />
									<Label fx:id="lblActiveSubscribers" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="0" />

									<Label text="Total Orders:" GridPane.columnIndex="0"
										GridPane.rowIndex="1" />
									<Label fx:id="lblTotalOrders" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="1" />

									<Label text="Reservations:" GridPane.columnIndex="0"
										GridPane.rowIndex="2" />
									<Label fx:id="lblReservationCount" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="2" />

									<Label text="Cancelled:" GridPane.columnIndex="0"
										GridPane.rowIndex="3" />
									<Label fx:id="lblCancelled" text="--"
										GridPane.columnIndex="1" GridPane.rowIndex="3" />
								</GridPane>

								<AreaChart fx:id="subscriberActivityChart"
									VBox.vgrow="ALWAYS">
									<xAxis>
										<CategoryAxis label="Date" />
									</xAxis>
									<yAxis>
										<NumberAxis label="Activity Count" />
									</yAxis>
								</AreaChart>
							</VBox>
						</Tab>
					</TabPane>

				</VBox>
			</Tab>

			<!-- Tab 3: Active Parkings -->
			<Tab text="Active Parkings">
				<VBox spacing="10">
					<padding>
						<Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
					</padding>

					<HBox spacing="10" alignment="CENTER_LEFT">
						<Label text="Current Active Parking Sessions"
							style="-fx-font-size: 16px; -fx-font-weight: bold;" />
						<Region HBox.hgrow="ALWAYS" />
						<Button text="Refresh Now" onAction="#loadActiveParkings" styleClass="primary-button" />
						<Label text="(Auto-refresh every 30 seconds)"
							style="-fx-font-style: italic;" />
					</HBox>

					<TableView fx:id="tableActiveParkings"
						VBox.vgrow="ALWAYS">
						<columns>
							<TableColumn fx:id="colParkingCode"
								text="Parking Code" prefWidth="100" />
							<TableColumn fx:id="colSubscriberName"
								text="Subscriber" prefWidth="150" />
							<TableColumn fx:id="colSpot" text="Spot"
								prefWidth="80" />
							<TableColumn fx:id="colEntryTime" text="Entry Time"
								prefWidth="150" />
							<TableColumn fx:id="colExpectedExit"
								text="Expected Exit" prefWidth="150" />
							<TableColumn fx:id="colType" text="Type"
								prefWidth="100" />
						</columns>
					</TableView>
				</VBox>
			</Tab>

			<!-- Tab 4: Subscribers -->
			<Tab text="Subscribers">
				<VBox spacing="10">
					<padding>
						<Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
					</padding>

					<HBox spacing="10" alignment="CENTER_LEFT">
						<Label text="Registered Subscribers"
							style="-fx-font-size: 16px; -fx-font-weight: bold;" />
						<Region HBox.hgrow="ALWAYS" />
						<Button text="Refresh" onAction="#loadSubscribers" styleClass="primary-button" />
					</HBox>

					<TableView fx:id="tableSubscribers" VBox.vgrow="ALWAYS">
						<columns>
							<TableColumn fx:id="colSubName" text="Name"
								prefWidth="150" />
							<TableColumn fx:id="colSubPhone" text="Phone"
								prefWidth="120" />
							<TableColumn fx:id="colSubEmail" text="Email"
								prefWidth="200" />
							<TableColumn fx:id="colSubCar" text="Car Number"
								prefWidth="100" />
							<TableColumn fx:id="colSubUsername"
								text="Username" prefWidth="120" />
						</columns>
					</TableView>
				</VBox>
			</Tab>

		</TabPane>
	</center>

	<!-- Status Bar -->
	<bottom>
		<HBox spacing="20" style="-fx-background-color: #BDC3C7;">
			<padding>
				<Insets bottom="5.0" left="20.0" right="20.0" top="5.0" />
			</padding>

			<Label text="Server: Connected" />
			<Separator orientation="VERTICAL" />
			<Label fx:id="lblManagerInfo" text="Manager: --" />
			<Separator orientation="VERTICAL" />
			<Label fx:id="lblLastUpdate" text="Last Update: --" />
			<Region HBox.hgrow="ALWAYS" />
			<Label text="BPark Manager Dashboard v1.0" />
		</HBox>
	</bottom>

</BorderPane>